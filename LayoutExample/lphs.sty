\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{ifthen}
\usepackage{tikz}
\usepackage{forloop}

\newcommand{\AssertAreEqual}[3]{
	\ifthenelse{\equal{#2}{#3}}
{#1: SUCCESS\par}
{#1: FAILURE, expected '#2', but was '#3'\par}
}

\newcommand{\AssertAreNotEqual}[3]{
	\ifthenelse{\equal{#2}{#3}}
	{#1: FAILURE, expected non '#2', but was '#3'\par}
	{#1: SUCCESS\par}
}

\makeatletter
\def\ece#1#2{\expandafter#1\csname#2\endcsname}%
\def\setproperty#1#2#3{\ece\protected@edef{#1@p#2}{#3}}%
\def\setpropertyglobal#1#2#3{\ece\protected@xdef{#1@p#2}{#3}}%
\def\getproperty#1#2{%
	\expandafter\ifx\csname#1@p#2\endcsname\relax
	\else \csname#1@p#2\endcsname
	\fi
}
\makeatother

\newcounter{GalleryCounter}

\newenvironment{gallery}{\setcounter{GalleryCounter}{0}}{}

\newcommand{\startgallery}{\setcounter{GalleryCounter}{0}}

\newcommand{\TestSettingCommand}
{
	\setproperty{TestSettingsCommand}{Data}{Test}
}

\newcommand{\TestSettingCommandWithArgument}[1]
{
	\setproperty{TestSettingsCommandWithArgument}{Data}{#1}	
}

\newcommand{\image}[2]
{
	\setproperty{GalleryImageFile}{\arabic{GalleryCounter}}{#1}
	\setproperty{GalleryImageCaption}{\arabic{GalleryCounter}}{#2}
	\stepcounter{GalleryCounter}
}

\newcounter{forLoopCounter}

\newcommand{\makegallery}{
	\begin{center}
		\forloop{forLoopCounter}{0}{\value{forLoopCounter}<\value{GalleryCounter}}
		{
			\begin{tabular}{l}
				\getproperty{GalleryImageFile}{\arabic{forLoopCounter}}\\
				\getproperty{GalleryImageCaption}{\arabic{forLoopCounter}}\\
			\end{tabular}
		}
	\end{center}
}
