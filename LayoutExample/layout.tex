\documentclass[aspectratio=169]{beamer}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{ifthen}
\usepackage{tikz}

\newcommand{\AssertAreEqual}[3]{
	\ifthenelse{\equal{#2}{#3}}
{#1: SUCCESS\par}
{#1: FAILURE, expected '#2', but was '#3'\par}
}

\newcommand{\AssertAreNotEqual}[3]{
	\ifthenelse{\equal{#2}{#3}}
	{#1: FAILURE, expected non '#2', but was '#3'\par}
	{#1: SUCCESS\par}
}

\makeatletter
\def\ece#1#2{\expandafter#1\csname#2\endcsname}%
\def\setproperty#1#2#3{\ece\protected@edef{#1@p#2}{#3}}%
\def\setpropertyglobal#1#2#3{\ece\protected@xdef{#1@p#2}{#3}}%
\def\getproperty#1#2{%
	\expandafter\ifx\csname#1@p#2\endcsname\relax
	\else \csname#1@p#2\endcsname
	\fi
}
\makeatother

\newcounter{GalleryCounter}

\newenvironment{gallery}{\setcounter{GalleryCounter}{0}\expandafter}{}

\newcommand{\startgallery}{\setcounter{GalleryCounter}{0}}

\newcommand{\TestSettingCommand}
{
	\setproperty{TestSettingsCommand}{Data}{Test}
}

\newcommand{\TestSettingCommandWithArgument}[1]
{
	\setproperty{TestSettingsCommandWithArgument}{Data}{#1}	
}

\newcommand{\image}[2]
{
	\setproperty{GalleryImageFile}{\arabic{GalleryCounter}}{\expandafter#1}
	\setproperty{GalleryImageCaption}{\arabic{GalleryCounter}}{\expandafter#2}
	\stepcounter{GalleryCounter}
}


\begin{document}

\begin{frame}\frametitle{Test system}

\AssertAreEqual{equal strings}{a}{a}
\AssertAreNotEqual{non-equal strings}{a}{b}

\newcommand{\foovariable}{1}

\AssertAreEqual{equal strings from a variable}{1}{\foovariable}
\AssertAreNotEqual{non-equal strings from a variable}{2}{\foovariable}


\newcounter{foocounter}
\stepcounter{foocounter}
\AssertAreEqual{equal strings from a counter}{1}{\value{foocounter}}
\AssertAreNotEqual{non-equal strings from a counter}{0}{\value{foocounter}}
\AssertAreEqual{equal strings from a counter with arabic cmd}{1}{\arabic{foocounter}}
\AssertAreNotEqual{non-equal strings from a counter  with arabic cmd}{0}{\arabic{foocounter}}


\end{frame}
\begin{frame}\frametitle{Properties}
	
\setproperty{image}{name}{test}
\AssertAreEqual{property}{test}{\getproperty{image}{name}}

\setcounter{foocounter}{1}
\setproperty{image}{\arabic{foocounter}}{test}
\AssertAreEqual{property indexed by counter}{test}{\getproperty{image}{1}}

\TestSettingCommand
\AssertAreEqual{settings variable inside command}{Test}{\getproperty{TestSettingsCommand}{Data}}

\TestSettingCommandWithArgument{Foo}
\AssertAreEqual{settings variable to a parameter inside command}{Foo}{\getproperty{TestSettingsCommandWithArgument}{Data}}

\end{frame}

\begin{frame}\frametitle{Simple gallery commands}
	
\startgallery
\AssertAreEqual{GalleryCounter after startgallery}{0}{\arabic{GalleryCounter}}

\setcounter{GalleryCounter}{2}
\startgallery
\AssertAreEqual{startgallery erases GalleryCounter}{0}{\arabic{GalleryCounter}}

\startgallery
\image{Q}{W}
\AssertAreEqual{image cmd sets file name}{Q}{\getproperty{GalleryImageFile}{0}}
\AssertAreEqual{image cmd sets caption}{W}{\getproperty{GalleryImageCaption}{0}}
\AssertAreEqual{image cmd increments GalleryCounter}{1}{\arabic{GalleryCounter}}

\image{R}{Y}
\AssertAreEqual{second image cmd sets file name}{R}{\getproperty{GalleryImageFile}{1}}
\AssertAreEqual{second image cmd sets caption}{Y}{\getproperty{GalleryImageCaption}{1}}
\AssertAreEqual{second image cmd increments GalleryCounter}{2}{\arabic{GalleryCounter}}

\end{frame}

\begin{frame}\frametitle{Gallery environment}

\begin{gallery}
\end{gallery}	
\AssertAreEqual{GalleryCounter after gallery env}{0}{\arabic{GalleryCounter}}

\setcounter{GalleryCounter}{0}
\begin{gallery}
\end{gallery}	
\AssertAreEqual{gallery env erases GalleryCounter}{0}{\arabic{GalleryCounter}}


\begin{gallery}
	\image{S}{F}
\end{gallery}	
\AssertAreEqual{image cmd sets file name}{S}{\getproperty{GalleryImageFile}{0}}
\AssertAreEqual{image cmd sets caption}{F}{\getproperty{GalleryImageCaption}{0}}


\end{frame}



\end{document}